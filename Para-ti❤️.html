<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Para el Amor de Mi Vida ❤️</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />

    <style>
      :root {
        --dark-color: #1a1a2e;
      }

      body {
        margin: 0;
        padding: 0;
        background: linear-gradient(
          135deg,
          #ffecd2 0%,
          #fcb69f 50%,
          #ffd1dc 100%
        );
        font-family: "Georgia", serif;
        overflow: hidden;
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* --- CONTENEDOR PRINCIPAL --- */
      #main-container {
        position: relative;
        width: 100%;
        height: 100%;
      }

      /* --- FASE 1: BOTÓN INICIAL CON ESTRELLAS FUGACES --- */
      .start-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 100;
        transition: opacity 1s ease;
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #16213e 50%,
          #0f3460 100%
        );
      }

      .start-overlay.fade-out {
        opacity: 0;
        pointer-events: none;
      }

      /* Estrellas de fondo fijas */
      .stars-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 1;
      }

      .star {
        position: absolute;
        width: 2px;
        height: 2px;
        background: white;
        border-radius: 50%;
        animation: twinkle 3s infinite;
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.3;
        }
        50% {
          opacity: 1;
        }
      }

      /* Contenedor de estrellas fugaces */
      .shooting-stars {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 2;
      }

      .shooting-star {
        position: absolute;
        width: 4px;
        height: 4px;
        background: #fff;
        border-radius: 50%;
        box-shadow: 0 0 6px 2px rgba(255, 255, 255, 0.8);
        opacity: 0;
        animation: shootingStar 3s linear;
      }

      .shooting-star::before {
        content: "";
        position: absolute;
        top: 50%;
        right: 0;
        transform: translateY(-50%);
        width: 0;
        height: 2px;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 1) 100%
        );
        animation: shootingStarTail 3s linear;
      }

      @keyframes shootingStar {
        0% {
          opacity: 0;
          transform: translateX(0) translateY(0) rotate(45deg);
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          opacity: 0;
          transform: translateX(120vw) translateY(50vh) rotate(10deg);
        }
      }

      @keyframes shootingStarTail {
        0% {
          width: 0;
        }
        30% {
          width: 100px;
        }
        100% {
          width: 0;
        }
      }

      .heart-btn {
        font-size: 80px;
        color: #ff6b9d;
        cursor: pointer;
        animation: beat 1.2s infinite;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: transform 0.5s;
        z-index: 10;
        text-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
      }

      .heart-btn span {
        font-size: 20px;
        margin-top: -10px;
        color: #fff;
        font-weight: bold;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      @keyframes beat {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      /* --- SUELO --- */
      .ground-line {
        position: absolute;
        bottom: 50px;
        left: 50%;
        transform: translateX(-50%);
        width: 0%;
        height: 2px;
        background-color: #333;
        transition: width 1.5s ease-out;
        z-index: 10;
      }

      /* --- WRAPPER DEL ÁRBOL (Canvas + Corazones) --- */
      #tree-wrapper {
        position: absolute;
        bottom: 50px;
        left: 50%;
        width: 0;
        height: 0;
        overflow: visible;
        transition: transform 2.5s ease-in-out;
        z-index: 5;
      }

      canvas {
        position: absolute;
        bottom: 0;
        left: -300px;
      }

      /* --- CORAZONES (HOJAS) --- */
      .leaf-heart {
        position: absolute;
        font-size: 0px;
        transform: translate(-50%, -50%);
        transition:
          font-size 0.5s ease-out,
          top 3s ease,
          opacity 3s ease;
        z-index: 6;
      }

      /* Contenedor del mensaje */
      .message-container {
        position: absolute;
        left: 60px;
        top: 100px;
        max-width: 400px;
        opacity: 0;
        transition: opacity 1s;
      }

      .message-container.visible {
        opacity: 1;
      }

      .message-title {
        font-size: 1.2rem;
        color: #5a4a42;
        margin-bottom: 25px;
        font-weight: normal;
      }

      .message-text {
        font-size: 1rem;
        color: #5a4a42;
        line-height: 1.9;
        margin-bottom: 15px;
        white-space: pre-line;
      }

      .message-signature {
        font-size: 0.95rem;
        color: #8b4513;
        font-style: italic;
        margin-top: 25px;
      }

      .counter-text {
        position: absolute;
        left: 60px;
        bottom: 80px;
        font-size: 0.9rem;
        color: #5a4a42;
        opacity: 0;
        transition: opacity 1s;
      }

      .counter-text.visible {
        opacity: 1;
      }

      .counter-numbers {
        font-size: 1.1rem;
        font-weight: bold;
        color: #333;
        margin-top: 5px;
      }

      .cursor {
        display: inline-block;
        width: 2px;
        height: 1.2rem;
        background-color: #333;
        animation: blink 1s infinite;
        vertical-align: middle;
      }

      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0;
        }
      }

      /* CLASES UTILITARIAS JS */
      .hidden {
        display: none !important;
      }
      .expand-ground {
        width: 80% !important;
      }
      .move-right {
        transform: translateX(350px) !important;
      }
      .show-message {
        opacity: 1;
      }

      /* ============================================ */
      /* RESPONSIVE DESIGN PARA MÓVILES */
      /* ============================================ */
      @media screen and (max-width: 768px) {
        #tree-wrapper {
          bottom: 150px;
          transform: scale(0.6);
          transform-origin: center bottom;
        }

        .move-right {
          transform: scale(0.6) translateX(0px) !important;
        }

        .message-container {
          left: 20px;
          right: 20px;
          top: 30px;
          max-width: none;
          text-align: center;
        }

        .message-title {
          font-size: 0.95rem;
          margin-bottom: 12px;
        }

        .message-text {
          font-size: 0.8rem;
          line-height: 1.5;
        }

        .message-signature {
          font-size: 0.75rem;
          margin-top: 12px;
        }

        .counter-text {
          left: 20px;
          right: 20px;
          bottom: 100px;
          font-size: 0.7rem;
          text-align: center;
        }

        .counter-numbers {
          font-size: 0.85rem;
        }

        .ground-line {
          bottom: 150px;
        }

        .heart-btn {
          font-size: 60px;
        }

        .heart-btn span {
          font-size: 16px;
        }
      }

      @media screen and (max-width: 480px) {
        #tree-wrapper {
          bottom: 130px;
          transform: scale(0.45);
        }

        .move-right {
          transform: scale(0.45) translateX(0px) !important;
        }

        .message-container {
          top: 20px;
          left: 15px;
          right: 15px;
        }

        .message-title {
          font-size: 0.85rem;
          margin-bottom: 10px;
        }

        .message-text {
          font-size: 0.75rem;
          line-height: 1.4;
        }

        .message-signature {
          font-size: 0.7rem;
        }

        .counter-text {
          bottom: 80px;
          left: 15px;
          right: 15px;
          font-size: 0.65rem;
        }

        .counter-numbers {
          font-size: 0.75rem;
        }

        .ground-line {
          bottom: 130px;
        }

        .heart-btn {
          font-size: 50px;
        }

        .heart-btn span {
          font-size: 14px;
        }
      }
    </style>
  </head>
  <body>
    <div id="main-container">
      <div class="start-overlay" id="startOverlay">
        <!-- Estrellas de fondo fijas -->
        <div class="stars-background" id="starsBackground"></div>

        <!-- Contenedor de estrellas fugaces -->
        <div class="shooting-stars" id="shootingStars"></div>

        <!-- Botón corazón -->
        <div class="heart-btn" id="startBtn">
          <i class="bx bxs-heart"></i> <span>Te quiero decir algo...</span>
        </div>
      </div>

      <div class="ground-line" id="groundLine"></div>

      <div id="tree-wrapper">
        <canvas id="treeCanvas" width="600" height="600"></canvas>
      </div>

      <!-- Contador de tiempo -->
      <div class="counter-text" id="counterText">
        <div>Mi amor por ti comenzó hace...</div>
        <div class="counter-numbers" id="counterNumbers">Calculando...</div>
      </div>

      <!-- Mensaje romántico -->
      <div class="message-container" id="messageContainer">
        <div class="message-title" id="messageTitle">
          <b>Para el amor de mi vida:</b>
        </div>
        <div class="message-text" id="messageText">
          <span id="typewriter" class="typewriter-text"></span
          ><span class="cursor"></span>
        </div>
        <div class="message-signature" id="messageSignature"></div>
      </div>
    </div>

    <!-- Música de fondo -->
    <audio id="backgroundMusic" loop>
      <source src="https://files.catbox.moe/9nklk2.mp3" type="audio/mpeg">
      Tu navegador no soporta audio HTML5.
    </audio>

    <script>
      // ============================================
      // CONFIGURACIÓN PERSONALIZABLE
      // ============================================
      const CONFIG = {
        // Fecha de inicio de la relación (Formato: Año, Mes-1, Día, Hora, Minuto)
        startDate: new Date("2025-10-04T00:00:00"),

        // Velocidad de dibujo de ramas (ms por pixel)
        branchDrawSpeed: 7,

        // Mensajes personalizables
        messageText: `Feliz San Valentín, 
amor de mi vida.

Eres la mejor ... ❤️`,

        signatureText: `— I Love You!`,

        // Colores de los corazones
        heartColors: ["#ff4d4d", "#ff9a9e", "#ff6b6b", "#ffcccc", "#d62828"],
      };

      // ============================================
      // INICIALIZACIÓN DE ESTRELLAS EN PANTALLA INICIAL
      // ============================================
      function initStarsBackground() {
        const starsContainer = document.getElementById("starsBackground");
        // Crear estrellas fijas de fondo
        for (let i = 0; i < 150; i++) {
          const star = document.createElement("div");
          star.className = "star";
          star.style.left = Math.random() * 100 + "%";
          star.style.top = Math.random() * 100 + "%";
          star.style.animationDelay = Math.random() * 3 + "s";
          starsContainer.appendChild(star);
        }
      }

      function createShootingStar() {
        const star = document.createElement("div");
        star.className = "shooting-star";
        star.style.top = Math.random() * 60 + "%";
        star.style.left = "-10%";

        const duration = Math.random() * 1.5 + 2;
        star.style.animationDuration = duration + "s";

        document.getElementById("shootingStars").appendChild(star);

        setTimeout(() => {
          star.remove();
        }, duration * 1000);
      }

      function startShootingStars() {
        // Crear algunas estrellas fugaces iniciales
        for (let i = 0; i < 3; i++) {
          setTimeout(() => createShootingStar(), i * 1000);
        }

        // Continuar creando estrellas fugaces aleatoriamente
        setInterval(() => {
          if (Math.random() > 0.4) {
            createShootingStar();
          }
        }, 1000);
      }

      // Inicializar estrellas al cargar la página
      window.addEventListener("load", () => {
        initStarsBackground();
        startShootingStars();
      });

      // ============================================
      // REFERENCIAS DOM
      // ============================================
      const startBtn = document.getElementById("startBtn");
      const startOverlay = document.getElementById("startOverlay");
      const groundLine = document.getElementById("groundLine");
      const treeWrapper = document.getElementById("tree-wrapper");
      const canvas = document.getElementById("treeCanvas");
      const ctx = canvas.getContext("2d");
      const messageContainer = document.getElementById("messageContainer");
      const typewriterElement = document.getElementById("typewriter");
      const counterTextElement = document.getElementById("counterText");
      const counterNumbersElement = document.getElementById("counterNumbers");
      const bgMusic = document.getElementById("backgroundMusic");
      
      // Configurar volumen inicial
      bgMusic.volume = 0.5; // 50% de volumen

      // Canvas fade settings
      let canvasInitialOpacity = 0.15;
      let canvasFadeDuration = 3500;
      let canvasFadeStart = null;

      // Variables de estado
      let isTreeBuilt = false;

      function fadeCanvas(timestamp) {
        if (!canvasFadeStart) canvasFadeStart = timestamp;
        const elapsed = timestamp - canvasFadeStart;
        const t = Math.min(1, elapsed / canvasFadeDuration);
        const value = canvasInitialOpacity + t * (1 - canvasInitialOpacity);
        canvas.style.opacity = value.toString();
        if (t < 1 && !isTreeBuilt) {
          requestAnimationFrame(fadeCanvas);
        } else {
          canvas.style.opacity = "1";
        }
      }

      // ============================================
      // INICIO - CLICK EN CORAZÓN
      // ============================================
      startBtn.addEventListener("click", () => {
        // Reproducir música de fondo
        bgMusic.play().catch(err => {
          console.log("Reproducción automática bloqueada:", err);
        });
        
        // Desaparecer pantalla inicial
        startOverlay.classList.add("fade-out");

        // Cambiar fondo a beige
        setTimeout(() => {
          document.body.style.background =
            "linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffd1dc 100%)";
          document.body.style.transition = "background 2s ease-in-out"; // ← Añade esto
        }, 500);

        // Aparecer suelo
        setTimeout(() => {
          groundLine.classList.add("expand-ground");
        }, 500);

        // Crecer el árbol
        setTimeout(() => {
          initTree();
        }, 1000);
      });

      // ============================================
      // LÓGICA DEL ÁRBOL (RECURSIVA CON TRIGONOMETRÍA)
      // ============================================
      function initTree() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        canvas.style.opacity = canvasInitialOpacity.toString();
        canvasFadeStart = null;
        requestAnimationFrame(fadeCanvas);
        growBranch(300, 600, 120, -90, 14);
      }

      function growBranch(x, y, len, angle, width) {
        const endX = x + len * Math.cos((angle * Math.PI) / 180);
        const endY = y + len * Math.sin((angle * Math.PI) / 180);
        const duration = Math.max(200, len * CONFIG.branchDrawSpeed);
        let startTime = null;
        let lastX = x;
        let lastY = y;

        function animateBranch(timestamp) {
          if (!startTime) startTime = timestamp;
          const progress = Math.min((timestamp - startTime) / duration, 1);
          const currentX = x + (endX - x) * progress;
          const currentY = y + (endY - y) * progress;

          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(currentX, currentY);
          ctx.strokeStyle = "#8B4513";
          ctx.lineWidth = width;
          ctx.lineCap = "round";
          ctx.stroke();

          lastX = currentX;
          lastY = currentY;

          if (progress < 1) {
            requestAnimationFrame(animateBranch);
            return;
          }

          // Caso base: rama pequeña, terminar y poner corazón
          if (len < 10) {
            createHeartLeaf(endX, endY);
            if (!isTreeBuilt) {
              isTreeBuilt = true;
              setTimeout(startPhaseThree, 5000);
            }
            return;
          }

          // Recursividad: crear 2 sub-ramas
          const angleVar = Math.random() * 20 + 15;
          growBranch(endX, endY, len * 0.75, angle - angleVar, width * 0.7);
          growBranch(endX, endY, len * 0.75, angle + angleVar, width * 0.7);
        }

        requestAnimationFrame(animateBranch);
      }

      // ============================================
      // CREAR HOJAS (CORAZONES)
      // ============================================
      let leafCounters = { left: 0, center: 0, right: 0 };

      function createHeartLeaf(x, y) {
        const icon = document.createElement("i");
        icon.className = "bx bxs-heart leaf-heart";
        icon.style.color =
          CONFIG.heartColors[
            Math.floor(Math.random() * CONFIG.heartColors.length)
          ];
        icon.style.left = x - 300 + "px";
        icon.style.bottom = 600 - y + "px";
        treeWrapper.appendChild(icon);

        // Determinar zona del árbol para patrón balanceado
        const zone = x < 250 ? "left" : x > 350 ? "right" : "center";
        let zoneDelay = 0;

        if (zone === "left") {
          zoneDelay = leafCounters.left * 40;
          leafCounters.left++;
        } else if (zone === "right") {
          zoneDelay = 1500 + leafCounters.right * 40;
          leafCounters.right++;
        } else {
          zoneDelay = 3000 + leafCounters.center * 40;
          leafCounters.center++;
        }

        const randomDelay = Math.random() * 400;
        const totalDelay = zoneDelay + randomDelay;

        setTimeout(() => {
          icon.style.fontSize = Math.random() * 15 + 10 + "px";
        }, totalDelay);
      }

      // ============================================
      // FASE 3: MOVER ÁRBOL Y MOSTRAR TEXTO
      // ============================================
      function startPhaseThree() {
        if (window.innerWidth > 768) {
          treeWrapper.classList.add("move-right");
        } else {
          treeWrapper.style.transform = "scale(0.6)";
          if (window.innerWidth <= 480) {
            treeWrapper.style.transform = "scale(0.45)";
          }
        }

        setTimeout(() => {
          if (counterTextElement) counterTextElement.classList.add("visible");
          startTimer();

          setTimeout(() => {
            if (messageContainer) messageContainer.classList.add("visible");
            typeWriterEffect();
            startFallingHearts();
            startBackgroundPetals();
          }, 3000);
        }, 2500);
      }

      // ============================================
      // MÁQUINA DE ESCRIBIR
      // ============================================
      function typeWriterEffect() {
        let i = 0;
        const speed = 50;
        function type() {
          if (i < CONFIG.messageText.length) {
            typewriterElement.textContent += CONFIG.messageText.charAt(i);
            i++;
            setTimeout(type, speed);
          } else {
            setTimeout(() => {
              const messageSignature =
                document.getElementById("messageSignature");
              if (messageSignature) {
                messageSignature.textContent = CONFIG.signatureText;
                messageSignature.style.opacity = "0";
                messageSignature.style.transition = "opacity 1s ease-in";
                setTimeout(() => {
                  messageSignature.style.opacity = "1";
                }, 50);
              }
            }, 500);
          }
        }
        type();
      }

      // ============================================
      // CONTADOR DE TIEMPO
      // ============================================
      function startTimer() {
        setInterval(() => {
          const now = new Date();
          const diff = now - CONFIG.startDate;

          const d = Math.floor(diff / (1000 * 60 * 60 * 24));
          const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
          const m = Math.floor((diff / (1000 * 60)) % 60);
          const s = Math.floor((diff / 1000) % 60);

          const html = `<b>${d}</b> días <b>${h}</b> horas <b>${m}</b> minutos <b>${s}</b> segundos`;
          if (counterNumbersElement) counterNumbersElement.innerHTML = html;
        }, 1000);
      }

      // ============================================
      // LLUVIA DE CORAZONES DEL ÁRBOL
      // ============================================
      function startFallingHearts() {
        setInterval(() => {
          const heart = document.createElement("i");
          heart.className = "bx bxs-heart";
          heart.style.position = "absolute";
          heart.style.color =
            CONFIG.heartColors[
              Math.floor(Math.random() * CONFIG.heartColors.length)
            ];
          heart.style.fontSize = Math.random() * 15 + 10 + "px";
          heart.style.opacity = 0.8;
          heart.style.zIndex = 4;

          let startX, startY;
          if (window.innerWidth > 768) {
            startX = window.innerWidth / 2 + 250 + (Math.random() * 200 - 100);
            startY = window.innerHeight * 0.35;
          } else if (window.innerWidth > 480) {
            startX = window.innerWidth / 2 + (Math.random() * 120 - 60);
            startY = window.innerHeight - 180 - 200;
          } else {
            startX = window.innerWidth / 2 + (Math.random() * 100 - 50);
            startY = window.innerHeight - 160 - 180;
          }

          heart.style.left = startX + "px";
          heart.style.top = startY + "px";
          document.body.appendChild(heart);

          const duration = Math.random() * 3 + 3;
          const rotations = Math.random() * 3 + 2;
          const rotationDeg = rotations * 360;
          heart.style.transition = `top ${duration}s linear, opacity ${duration}s ease-in, transform ${duration}s ease-in-out`;

          setTimeout(() => {
            heart.style.top = "95%";
            heart.style.opacity = 0;
            heart.style.transform = `rotate(${rotationDeg}deg)`;
          }, 50);

          setTimeout(() => {
            heart.remove();
          }, duration * 1000);
        }, 300);
      }

      // ============================================
      // PÉTALOS DE FONDO
      // ============================================
      function startBackgroundPetals() {
        setInterval(() => {
          const petal = document.createElement("i");
          petal.className = "bx bxs-heart";
          petal.style.position = "absolute";
          petal.style.color =
            CONFIG.heartColors[
              Math.floor(Math.random() * CONFIG.heartColors.length)
            ];
          petal.style.fontSize = Math.random() * 12 + 8 + "px";
          petal.style.opacity = 0.25;
          petal.style.zIndex = 1;

          const startX = Math.random() * window.innerWidth;
          const startY = -50;
          petal.style.left = startX + "px";
          petal.style.top = startY + "px";
          document.body.appendChild(petal);

          const duration = Math.random() * 5 + 6;
          const rotations = Math.random() * 2 + 1;
          const rotationDeg = rotations * 360;
          const drift = (Math.random() - 0.5) * 100;

          petal.style.transition = `top ${duration}s linear, left ${duration}s ease-in-out, opacity ${duration}s ease-in, transform ${duration}s ease-in-out`;

          setTimeout(() => {
            petal.style.top = window.innerHeight + 50 + "px";
            petal.style.left = startX + drift + "px";
            petal.style.opacity = 0;
            petal.style.transform = `rotate(${rotationDeg}deg)`;
          }, 50);

          setTimeout(() => {
            petal.remove();
          }, duration * 1000);
        }, 300);
      }
    </script>
  </body>
</html>
